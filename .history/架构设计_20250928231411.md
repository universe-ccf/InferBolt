# Voicery · 架构设计文档

> 目标：一个可搜索与对话的“角色扮演 + 语音”应用。支持文本与语音双链路、多轮记忆、技能路由（思辨类 & 关怀类 & 教学类），并与七牛云端大模型兼容接口对接（LLM / ASR / TTS）。

---

## 1. 总体架构



**数据流：**

- **文本链路**：UI → `respond()` →（路由）→ 普通对话或技能 → LLM → 更新 `SessionState.messages` → UI显示（支持“整段”或“真·流式”）。
- **语音链路**：UI录音 → `respond_voice()`：
  1. `ASRWsClient.transcribe()`（WS帧协议 + gzip + JSON）  
  2. 得到 `user_text` 后复用 `respond()` → LLM  
  3. `TTSClient.synthesize()` → 生成 `wav` → 文件缓存 → 返回路径  
  4. UI 播放（当前版本：**HTML自动播放**；也保留回退：Gradio `gr.Audio`）。

---